# --- TOPIC: TELEMETRIA (High Volume / Throughput) ---
apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaTopic
metadata:
  name: sensor-telemetry
  namespace: kafka
  labels:
    strimzi.io/cluster: iot-sensor-cluster
spec:
  partitions: 3                 # Permette parallelismo fino a 3 consumer concorrenti
  replicas: 2                   # Ridondanza dei dati
  config:
    # Retention Policy: I dati vengono cancellati dopo 7 giorni (dati operativi a breve termine).
    retention.ms: 604800000     # 7 giorni
    segment.bytes: 1073741824   # 1GB
    
    # Compressione LZ4: Fondamentale per IoT. Riduce carico rete e I/O su disco.
    compression.type: lz4       
---
# --- TOPIC: ALLARMI (Critical / Durability) ---
apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaTopic
metadata:
  name: sensor-alerts
  namespace: kafka
  labels:
    strimzi.io/cluster: iot-sensor-cluster
spec:
  partitions: 2               # Volume minore, basta meno parallelismo
  replicas: 2
  config:
    # Retention estesa (30 giorni) per permettere Audit e analisi post-incidente.
    retention.ms: 2592000000  # 30 giorni (più lungo per audit)
    segment.bytes: 536870912  # 512MB

    # OVERRIDE DI SICUREZZA:
    # Qui imponiamo min.insync.replicas=2.
    # Significa che per questo topic specifico, Kafka RIFIUTERÀ la scrittura se
    # non può garantirne la copia su entrambi i broker.
    # Trade-off: Zero Data Loss garantito, ma minor disponibilità se un nodo cade.
    min.insync.replicas: 2 